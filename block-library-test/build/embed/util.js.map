{"version":3,"names":["_dedupe","_interopRequireDefault","require","_memize","_components","_element","_blocks","_constants","_lockUnlock","metadata","$schema","apiVersion","name","title","category","description","textdomain","attributes","url","type","__experimentalRole","caption","source","selector","providerNameSlug","allowResponsive","responsive","previewable","supports","align","spacing","margin","editorStyle","style","DEFAULT_EMBED_BLOCK","getEmbedInfoByProvider","provider","getBlockVariations","find","exports","matchesPatterns","patterns","some","pattern","match","findMoreSuitableBlock","isFromWordPress","html","includes","getPhotoHtml","photo","imageUrl","thumbnail_url","photoPreview","_react","createElement","src","alt","width","renderToString","createUpgradedEmbedBlock","props","attributesFromPreview","preview","restAttributes","getBlockType","matchedBlock","isCurrentBlockWP","WP_EMBED_TYPE","shouldCreateNewBlock","createBlock","wpVariation","hasAspectRatioClass","existingClassNames","ASPECT_RATIOS","className","removeAspectRatioClasses","aspectRatioClassNames","reduce","accumulator","classnames","getClassNames","previewDocument","document","implementation","createHTMLDocument","body","innerHTML","iframe","querySelector","height","aspectRatio","toFixed","ratioIndex","length","potentialRatio","ratio","ratioDiff","fallback","onReplace","link","href","content","getAttributesFromPreview","memoize","currentClassNames","isResponsive","provider_name","providerName","kebabCase","unlock","componentsPrivateApis","toLowerCase","getMergedAttributesWithPreview","currentAttributes"],"sources":["@wordpress/block-library/src/embed/util.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames/dedupe';\nimport memoize from 'memize';\n\n/**\n * WordPress dependencies\n */\nimport { privateApis as componentsPrivateApis } from '@wordpress/components';\nimport { renderToString } from '@wordpress/element';\nimport {\n\tcreateBlock,\n\tgetBlockType,\n\tgetBlockVariations,\n} from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport metadata from './block.json';\nimport { ASPECT_RATIOS, WP_EMBED_TYPE } from './constants';\nimport { unlock } from '../lock-unlock';\n\nconst { name: DEFAULT_EMBED_BLOCK } = metadata;\n\n/** @typedef {import('@wordpress/blocks').WPBlockVariation} WPBlockVariation */\n\n/**\n * Returns the embed block's information by matching the provided service provider\n *\n * @param {string} provider The embed block's provider\n * @return {WPBlockVariation} The embed block's information\n */\nexport const getEmbedInfoByProvider = ( provider ) =>\n\tgetBlockVariations( DEFAULT_EMBED_BLOCK )?.find(\n\t\t( { name } ) => name === provider\n\t);\n\n/**\n * Returns true if any of the regular expressions match the URL.\n *\n * @param {string} url      The URL to test.\n * @param {Array}  patterns The list of regular expressions to test agains.\n * @return {boolean} True if any of the regular expressions match the URL.\n */\nexport const matchesPatterns = ( url, patterns = [] ) =>\n\tpatterns.some( ( pattern ) => url.match( pattern ) );\n\n/**\n * Finds the block variation that should be used for the URL,\n * based on the provided URL and the variation's patterns.\n *\n * @param {string} url The URL to test.\n * @return {WPBlockVariation} The block variation that should be used for this URL\n */\nexport const findMoreSuitableBlock = ( url ) =>\n\tgetBlockVariations( DEFAULT_EMBED_BLOCK )?.find( ( { patterns } ) =>\n\t\tmatchesPatterns( url, patterns )\n\t);\n\nexport const isFromWordPress = ( html ) =>\n\thtml && html.includes( 'class=\"wp-embedded-content\"' );\n\nexport const getPhotoHtml = ( photo ) => {\n\t// If full image url not found use thumbnail.\n\tconst imageUrl = photo.url || photo.thumbnail_url;\n\n\t// 100% width for the preview so it fits nicely into the document, some \"thumbnails\" are\n\t// actually the full size photo.\n\tconst photoPreview = (\n\t\t<p>\n\t\t\t<img src={ imageUrl } alt={ photo.title } width=\"100%\" />\n\t\t</p>\n\t);\n\treturn renderToString( photoPreview );\n};\n\n/**\n * Creates a more suitable embed block based on the passed in props\n * and attributes generated from an embed block's preview.\n *\n * We require `attributesFromPreview` to be generated from the latest attributes\n * and preview, and because of the way the react lifecycle operates, we can't\n * guarantee that the attributes contained in the block's props are the latest\n * versions, so we require that these are generated separately.\n * See `getAttributesFromPreview` in the generated embed edit component.\n *\n * @param {Object} props                   The block's props.\n * @param {Object} [attributesFromPreview] Attributes generated from the block's most up to date preview.\n * @return {Object|undefined} A more suitable embed block if one exists.\n */\nexport const createUpgradedEmbedBlock = (\n\tprops,\n\tattributesFromPreview = {}\n) => {\n\tconst { preview, attributes = {} } = props;\n\tconst { url, providerNameSlug, type, ...restAttributes } = attributes;\n\n\tif ( ! url || ! getBlockType( DEFAULT_EMBED_BLOCK ) ) return;\n\n\tconst matchedBlock = findMoreSuitableBlock( url );\n\n\t// WordPress blocks can work on multiple sites, and so don't have patterns,\n\t// so if we're in a WordPress block, assume the user has chosen it for a WordPress URL.\n\tconst isCurrentBlockWP =\n\t\tproviderNameSlug === 'wordpress' || type === WP_EMBED_TYPE;\n\t// If current block is not WordPress and a more suitable block found\n\t// that is different from the current one, create the new matched block.\n\tconst shouldCreateNewBlock =\n\t\t! isCurrentBlockWP &&\n\t\tmatchedBlock &&\n\t\t( matchedBlock.attributes.providerNameSlug !== providerNameSlug ||\n\t\t\t! providerNameSlug );\n\tif ( shouldCreateNewBlock ) {\n\t\treturn createBlock( DEFAULT_EMBED_BLOCK, {\n\t\t\turl,\n\t\t\t...restAttributes,\n\t\t\t...matchedBlock.attributes,\n\t\t} );\n\t}\n\n\tconst wpVariation = getBlockVariations( DEFAULT_EMBED_BLOCK )?.find(\n\t\t( { name } ) => name === 'wordpress'\n\t);\n\n\t// We can't match the URL for WordPress embeds, we have to check the HTML instead.\n\tif (\n\t\t! wpVariation ||\n\t\t! preview ||\n\t\t! isFromWordPress( preview.html ) ||\n\t\tisCurrentBlockWP\n\t) {\n\t\treturn;\n\t}\n\n\t// This is not the WordPress embed block so transform it into one.\n\treturn createBlock( DEFAULT_EMBED_BLOCK, {\n\t\turl,\n\t\t...wpVariation.attributes,\n\t\t// By now we have the preview, but when the new block first renders, it\n\t\t// won't have had all the attributes set, and so won't get the correct\n\t\t// type and it won't render correctly. So, we pass through the current attributes\n\t\t// here so that the initial render works when we switch to the WordPress\n\t\t// block. This only affects the WordPress block because it can't be\n\t\t// rendered in the usual Sandbox (it has a sandbox of its own) and it\n\t\t// relies on the preview to set the correct render type.\n\t\t...attributesFromPreview,\n\t} );\n};\n\n/**\n * Determine if the block already has an aspect ratio class applied.\n *\n * @param {string} existingClassNames Existing block classes.\n * @return {boolean} True or false if the classnames contain an aspect ratio class.\n */\nexport const hasAspectRatioClass = ( existingClassNames ) => {\n\tif ( ! existingClassNames ) {\n\t\treturn false;\n\t}\n\treturn ASPECT_RATIOS.some( ( { className } ) =>\n\t\texistingClassNames.includes( className )\n\t);\n};\n\n/**\n * Removes all previously set aspect ratio related classes and return the rest\n * existing class names.\n *\n * @param {string} existingClassNames Any existing class names.\n * @return {string} The class names without any aspect ratio related class.\n */\nexport const removeAspectRatioClasses = ( existingClassNames ) => {\n\tif ( ! existingClassNames ) {\n\t\t// Avoids extraneous work and also, by returning the same value as\n\t\t// received, ensures the post is not dirtied by a change of the block\n\t\t// attribute from `undefined` to an emtpy string.\n\t\treturn existingClassNames;\n\t}\n\tconst aspectRatioClassNames = ASPECT_RATIOS.reduce(\n\t\t( accumulator, { className } ) => {\n\t\t\taccumulator[ className ] = false;\n\t\t\treturn accumulator;\n\t\t},\n\t\t{ 'wp-has-aspect-ratio': false }\n\t);\n\treturn classnames( existingClassNames, aspectRatioClassNames );\n};\n\n/**\n * Returns class names with any relevant responsive aspect ratio names.\n *\n * @param {string}  html               The preview HTML that possibly contains an iframe with width and height set.\n * @param {string}  existingClassNames Any existing class names.\n * @param {boolean} allowResponsive    If the responsive class names should be added, or removed.\n * @return {string} Deduped class names.\n */\nexport function getClassNames(\n\thtml,\n\texistingClassNames,\n\tallowResponsive = true\n) {\n\tif ( ! allowResponsive ) {\n\t\treturn removeAspectRatioClasses( existingClassNames );\n\t}\n\n\tconst previewDocument = document.implementation.createHTMLDocument( '' );\n\tpreviewDocument.body.innerHTML = html;\n\tconst iframe = previewDocument.body.querySelector( 'iframe' );\n\n\t// If we have a fixed aspect iframe, and it's a responsive embed block.\n\tif ( iframe && iframe.height && iframe.width ) {\n\t\tconst aspectRatio = ( iframe.width / iframe.height ).toFixed( 2 );\n\t\t// Given the actual aspect ratio, find the widest ratio to support it.\n\t\tfor (\n\t\t\tlet ratioIndex = 0;\n\t\t\tratioIndex < ASPECT_RATIOS.length;\n\t\t\tratioIndex++\n\t\t) {\n\t\t\tconst potentialRatio = ASPECT_RATIOS[ ratioIndex ];\n\t\t\tif ( aspectRatio >= potentialRatio.ratio ) {\n\t\t\t\t// Evaluate the difference between actual aspect ratio and closest match.\n\t\t\t\t// If the difference is too big, do not scale the embed according to aspect ratio.\n\t\t\t\tconst ratioDiff = aspectRatio - potentialRatio.ratio;\n\t\t\t\tif ( ratioDiff > 0.1 ) {\n\t\t\t\t\t// No close aspect ratio match found.\n\t\t\t\t\treturn removeAspectRatioClasses( existingClassNames );\n\t\t\t\t}\n\t\t\t\t// Close aspect ratio match found.\n\t\t\t\treturn classnames(\n\t\t\t\t\tremoveAspectRatioClasses( existingClassNames ),\n\t\t\t\t\tpotentialRatio.className,\n\t\t\t\t\t'wp-has-aspect-ratio'\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn existingClassNames;\n}\n\n/**\n * Fallback behaviour for unembeddable URLs.\n * Creates a paragraph block containing a link to the URL, and calls `onReplace`.\n *\n * @param {string}   url       The URL that could not be embedded.\n * @param {Function} onReplace Function to call with the created fallback block.\n */\nexport function fallback( url, onReplace ) {\n\tconst link = <a href={ url }>{ url }</a>;\n\tonReplace(\n\t\tcreateBlock( 'core/paragraph', { content: renderToString( link ) } )\n\t);\n}\n\n/***\n * Gets block attributes based on the preview and responsive state.\n *\n * @param {Object} preview The preview data.\n * @param {string} title The block's title, e.g. Twitter.\n * @param {Object} currentClassNames The block's current class names.\n * @param {boolean} isResponsive Boolean indicating if the block supports responsive content.\n * @param {boolean} allowResponsive Apply responsive classes to fixed size content.\n * @return {Object} Attributes and values.\n */\nexport const getAttributesFromPreview = memoize(\n\t(\n\t\tpreview,\n\t\ttitle,\n\t\tcurrentClassNames,\n\t\tisResponsive,\n\t\tallowResponsive = true\n\t) => {\n\t\tif ( ! preview ) {\n\t\t\treturn {};\n\t\t}\n\n\t\tconst attributes = {};\n\t\t// Some plugins only return HTML with no type info, so default this to 'rich'.\n\t\tlet { type = 'rich' } = preview;\n\t\t// If we got a provider name from the API, use it for the slug, otherwise we use the title,\n\t\t// because not all embed code gives us a provider name.\n\t\tconst { html, provider_name: providerName } = preview;\n\t\tconst { kebabCase } = unlock( componentsPrivateApis );\n\t\tconst providerNameSlug = kebabCase(\n\t\t\t( providerName || title ).toLowerCase()\n\t\t);\n\n\t\tif ( isFromWordPress( html ) ) {\n\t\t\ttype = WP_EMBED_TYPE;\n\t\t}\n\n\t\tif ( html || 'photo' === type ) {\n\t\t\tattributes.type = type;\n\t\t\tattributes.providerNameSlug = providerNameSlug;\n\t\t}\n\n\t\t// Aspect ratio classes are removed when the embed URL is updated.\n\t\t// If the embed already has an aspect ratio class, that means the URL has not changed.\n\t\t// Which also means no need to regenerate it with getClassNames.\n\t\tif ( hasAspectRatioClass( currentClassNames ) ) {\n\t\t\treturn attributes;\n\t\t}\n\n\t\tattributes.className = getClassNames(\n\t\t\thtml,\n\t\t\tcurrentClassNames,\n\t\t\tisResponsive && allowResponsive\n\t\t);\n\n\t\treturn attributes;\n\t}\n);\n\n/**\n * Returns the attributes derived from the preview, merged with the current attributes.\n *\n * @param {Object}  currentAttributes The current attributes of the block.\n * @param {Object}  preview           The preview data.\n * @param {string}  title             The block's title, e.g. Twitter.\n * @param {boolean} isResponsive      Boolean indicating if the block supports responsive content.\n * @return {Object} Merged attributes.\n */\nexport const getMergedAttributesWithPreview = (\n\tcurrentAttributes,\n\tpreview,\n\ttitle,\n\tisResponsive\n) => {\n\tconst { allowResponsive, className } = currentAttributes;\n\n\treturn {\n\t\t...currentAttributes,\n\t\t...getAttributesFromPreview(\n\t\t\tpreview,\n\t\t\ttitle,\n\t\t\tclassName,\n\t\t\tisResponsive,\n\t\t\tallowResponsive\n\t\t),\n\t};\n};\n"],"mappings":"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"}