{"version":3,"names":["_classnames","_interopRequireDefault","require","_element","_compose","_i18n","_blockEditor","_components","_icons","_blocks","Caption","key","attributes","setAttributes","isSelected","insertBlocksAfter","placeholder","__","label","showToolbarButton","className","caption","prevCaption","usePrevious","isCaptionEmpty","RichText","isEmpty","isPrevCaptionEmpty","showCaption","setShowCaption","useState","useEffect","ref","useCallback","node","focus","_react","createElement","Fragment","BlockControls","group","ToolbarButton","onClick","undefined","icon","captionIcon","isPressed","identifier","tagName","classnames","__experimentalGetElementClassName","value","onChange","inlineToolbar","__unstableOnSplitAtEnd","createBlock","getDefaultBlockName"],"sources":["@wordpress/block-library/src/utils/caption.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useState, useEffect, useCallback } from '@wordpress/element';\nimport { usePrevious } from '@wordpress/compose';\nimport { __ } from '@wordpress/i18n';\nimport {\n\tRichText,\n\tBlockControls,\n\t__experimentalGetElementClassName,\n} from '@wordpress/block-editor';\nimport { ToolbarButton } from '@wordpress/components';\nimport { caption as captionIcon } from '@wordpress/icons';\nimport { createBlock, getDefaultBlockName } from '@wordpress/blocks';\n\nexport function Caption( {\n\tkey = 'caption',\n\tattributes,\n\tsetAttributes,\n\tisSelected,\n\tinsertBlocksAfter,\n\tplaceholder = __( 'Add caption' ),\n\tlabel = __( 'Caption text' ),\n\tshowToolbarButton = true,\n\tclassName,\n} ) {\n\tconst caption = attributes[ key ];\n\tconst prevCaption = usePrevious( caption );\n\tconst isCaptionEmpty = RichText.isEmpty( caption );\n\tconst isPrevCaptionEmpty = RichText.isEmpty( prevCaption );\n\tconst [ showCaption, setShowCaption ] = useState( ! isCaptionEmpty );\n\n\t// We need to show the caption when changes come from\n\t// history navigation(undo/redo).\n\tuseEffect( () => {\n\t\tif ( ! isCaptionEmpty && isPrevCaptionEmpty ) {\n\t\t\tsetShowCaption( true );\n\t\t}\n\t}, [ isCaptionEmpty, isPrevCaptionEmpty ] );\n\n\tuseEffect( () => {\n\t\tif ( ! isSelected && isCaptionEmpty ) {\n\t\t\tsetShowCaption( false );\n\t\t}\n\t}, [ isSelected, isCaptionEmpty ] );\n\n\t// Focus the caption when we click to add one.\n\tconst ref = useCallback(\n\t\t( node ) => {\n\t\t\tif ( node && isCaptionEmpty ) {\n\t\t\t\tnode.focus();\n\t\t\t}\n\t\t},\n\t\t[ isCaptionEmpty ]\n\t);\n\treturn (\n\t\t<>\n\t\t\t{ showToolbarButton && (\n\t\t\t\t<BlockControls group=\"block\">\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\tsetShowCaption( ! showCaption );\n\t\t\t\t\t\t\tif ( showCaption && caption ) {\n\t\t\t\t\t\t\t\tsetAttributes( { caption: undefined } );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} }\n\t\t\t\t\t\ticon={ captionIcon }\n\t\t\t\t\t\tisPressed={ showCaption }\n\t\t\t\t\t\tlabel={\n\t\t\t\t\t\t\tshowCaption\n\t\t\t\t\t\t\t\t? __( 'Remove caption' )\n\t\t\t\t\t\t\t\t: __( 'Add caption' )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t{ showCaption &&\n\t\t\t\t( ! RichText.isEmpty( caption ) || isSelected ) && (\n\t\t\t\t\t<RichText\n\t\t\t\t\t\tidentifier={ key }\n\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\tclassName,\n\t\t\t\t\t\t\t__experimentalGetElementClassName( 'caption' )\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\taria-label={ label }\n\t\t\t\t\t\tplaceholder={ placeholder }\n\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\tsetAttributes( { caption: value } )\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t__unstableOnSplitAtEnd={ () =>\n\t\t\t\t\t\t\tinsertBlocksAfter(\n\t\t\t\t\t\t\t\tcreateBlock( getDefaultBlockName() )\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t</>\n\t);\n}\n"],"mappings":"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"}