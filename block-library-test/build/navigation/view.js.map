{"version":3,"names":["_interactivity","require","_constants","focusableSelectors","document","addEventListener","state","actions","store","roleAttribute","ctx","getContext","type","isMenuOpen","ariaModal","ariaLabel","Object","values","menuOpenedBy","filter","Boolean","length","overlayOpenedBy","submenuOpenedBy","openMenuOnHover","openMenu","closeMenuOnHover","closeMenu","openMenuOnClick","ref","getElement","previousFocus","closeMenuOnClick","openMenuOnFocus","toggleMenuOnClick","window","activeElement","focus","click","handleMenuKeydown","event","firstFocusableElement","lastFocusableElement","key","shiftKey","preventDefault","handleMenuFocusout","modal","relatedTarget","contains","target","menuOpenedOn","documentElement","classList","add","menuClosedOn","remove","callbacks","initMenu","focusableElements","querySelectorAll","focusFirstElement","initNav","context","mediaQuery","matchMedia","NAVIGATION_MOBILE_COLLAPSE","isCollapsed","matches","handleCollapse","removeEventListener"],"sources":["@wordpress/block-library/src/navigation/view.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { store, getContext, getElement } from '@wordpress/interactivity';\n\n/**\n * Internal dependencies\n */\nimport { NAVIGATION_MOBILE_COLLAPSE } from './constants';\n\nconst focusableSelectors = [\n\t'a[href]',\n\t'input:not([disabled]):not([type=\"hidden\"]):not([aria-hidden])',\n\t'select:not([disabled]):not([aria-hidden])',\n\t'textarea:not([disabled]):not([aria-hidden])',\n\t'button:not([disabled]):not([aria-hidden])',\n\t'[contenteditable]',\n\t'[tabindex]:not([tabindex^=\"-\"])',\n];\n\n// This is a fix for Safari in iOS/iPadOS. Without it, Safari doesn't focus out\n// when the user taps in the body. It can be removed once we add an overlay to\n// capture the clicks, instead of relying on the focusout event.\ndocument.addEventListener( 'click', () => {} );\n\nconst { state, actions } = store( 'core/navigation', {\n\tstate: {\n\t\tget roleAttribute() {\n\t\t\tconst ctx = getContext();\n\t\t\treturn ctx.type === 'overlay' && state.isMenuOpen ? 'dialog' : null;\n\t\t},\n\t\tget ariaModal() {\n\t\t\tconst ctx = getContext();\n\t\t\treturn ctx.type === 'overlay' && state.isMenuOpen ? 'true' : null;\n\t\t},\n\t\tget ariaLabel() {\n\t\t\tconst ctx = getContext();\n\t\t\treturn ctx.type === 'overlay' && state.isMenuOpen\n\t\t\t\t? ctx.ariaLabel\n\t\t\t\t: null;\n\t\t},\n\t\tget isMenuOpen() {\n\t\t\t// The menu is opened if either `click`, `hover` or `focus` is true.\n\t\t\treturn (\n\t\t\t\tObject.values( state.menuOpenedBy ).filter( Boolean ).length > 0\n\t\t\t);\n\t\t},\n\t\tget menuOpenedBy() {\n\t\t\tconst ctx = getContext();\n\t\t\treturn ctx.type === 'overlay'\n\t\t\t\t? ctx.overlayOpenedBy\n\t\t\t\t: ctx.submenuOpenedBy;\n\t\t},\n\t},\n\tactions: {\n\t\topenMenuOnHover() {\n\t\t\tconst { type, overlayOpenedBy } = getContext();\n\t\t\tif (\n\t\t\t\ttype === 'submenu' &&\n\t\t\t\t// Only open on hover if the overlay is closed.\n\t\t\t\tObject.values( overlayOpenedBy || {} ).filter( Boolean )\n\t\t\t\t\t.length === 0\n\t\t\t)\n\t\t\t\tactions.openMenu( 'hover' );\n\t\t},\n\t\tcloseMenuOnHover() {\n\t\t\tactions.closeMenu( 'hover' );\n\t\t},\n\t\topenMenuOnClick() {\n\t\t\tconst ctx = getContext();\n\t\t\tconst { ref } = getElement();\n\t\t\tctx.previousFocus = ref;\n\t\t\tactions.openMenu( 'click' );\n\t\t},\n\t\tcloseMenuOnClick() {\n\t\t\tactions.closeMenu( 'click' );\n\t\t\tactions.closeMenu( 'focus' );\n\t\t},\n\t\topenMenuOnFocus() {\n\t\t\tactions.openMenu( 'focus' );\n\t\t},\n\t\ttoggleMenuOnClick() {\n\t\t\tconst ctx = getContext();\n\t\t\tconst { ref } = getElement();\n\t\t\t// Safari won't send focus to the clicked element, so we need to manually place it: https://bugs.webkit.org/show_bug.cgi?id=22261\n\t\t\tif ( window.document.activeElement !== ref ) ref.focus();\n\t\t\tconst { menuOpenedBy } = state;\n\t\t\tif ( menuOpenedBy.click || menuOpenedBy.focus ) {\n\t\t\t\tactions.closeMenu( 'click' );\n\t\t\t\tactions.closeMenu( 'focus' );\n\t\t\t} else {\n\t\t\t\tctx.previousFocus = ref;\n\t\t\t\tactions.openMenu( 'click' );\n\t\t\t}\n\t\t},\n\t\thandleMenuKeydown( event ) {\n\t\t\tconst { type, firstFocusableElement, lastFocusableElement } =\n\t\t\t\tgetContext();\n\t\t\tif ( state.menuOpenedBy.click ) {\n\t\t\t\t// If Escape close the menu.\n\t\t\t\tif ( event?.key === 'Escape' ) {\n\t\t\t\t\tactions.closeMenu( 'click' );\n\t\t\t\t\tactions.closeMenu( 'focus' );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Trap focus if it is an overlay (main menu).\n\t\t\t\tif ( type === 'overlay' && event.key === 'Tab' ) {\n\t\t\t\t\t// If shift + tab it change the direction.\n\t\t\t\t\tif (\n\t\t\t\t\t\tevent.shiftKey &&\n\t\t\t\t\t\twindow.document.activeElement === firstFocusableElement\n\t\t\t\t\t) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tlastFocusableElement.focus();\n\t\t\t\t\t} else if (\n\t\t\t\t\t\t! event.shiftKey &&\n\t\t\t\t\t\twindow.document.activeElement === lastFocusableElement\n\t\t\t\t\t) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tfirstFocusableElement.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\thandleMenuFocusout( event ) {\n\t\t\tconst { modal } = getContext();\n\t\t\t// If focus is outside modal, and in the document, close menu\n\t\t\t// event.target === The element losing focus\n\t\t\t// event.relatedTarget === The element receiving focus (if any)\n\t\t\t// When focusout is outsite the document,\n\t\t\t// `window.document.activeElement` doesn't change.\n\n\t\t\t// The event.relatedTarget is null when something outside the navigation menu is clicked. This is only necessary for Safari.\n\t\t\tif (\n\t\t\t\tevent.relatedTarget === null ||\n\t\t\t\t( ! modal?.contains( event.relatedTarget ) &&\n\t\t\t\t\tevent.target !== window.document.activeElement )\n\t\t\t) {\n\t\t\t\tactions.closeMenu( 'click' );\n\t\t\t\tactions.closeMenu( 'focus' );\n\t\t\t}\n\t\t},\n\n\t\topenMenu( menuOpenedOn = 'click' ) {\n\t\t\tconst { type } = getContext();\n\t\t\tstate.menuOpenedBy[ menuOpenedOn ] = true;\n\t\t\tif ( type === 'overlay' ) {\n\t\t\t\t// Add a `has-modal-open` class to the <html> root.\n\t\t\t\tdocument.documentElement.classList.add( 'has-modal-open' );\n\t\t\t}\n\t\t},\n\n\t\tcloseMenu( menuClosedOn = 'click' ) {\n\t\t\tconst ctx = getContext();\n\t\t\tstate.menuOpenedBy[ menuClosedOn ] = false;\n\t\t\t// Check if the menu is still open or not.\n\t\t\tif ( ! state.isMenuOpen ) {\n\t\t\t\tif ( ctx.modal?.contains( window.document.activeElement ) ) {\n\t\t\t\t\tctx.previousFocus?.focus();\n\t\t\t\t}\n\t\t\t\tctx.modal = null;\n\t\t\t\tctx.previousFocus = null;\n\t\t\t\tif ( ctx.type === 'overlay' ) {\n\t\t\t\t\tdocument.documentElement.classList.remove(\n\t\t\t\t\t\t'has-modal-open'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\tcallbacks: {\n\t\tinitMenu() {\n\t\t\tconst ctx = getContext();\n\t\t\tconst { ref } = getElement();\n\t\t\tif ( state.isMenuOpen ) {\n\t\t\t\tconst focusableElements =\n\t\t\t\t\tref.querySelectorAll( focusableSelectors );\n\t\t\t\tctx.modal = ref;\n\t\t\t\tctx.firstFocusableElement = focusableElements[ 0 ];\n\t\t\t\tctx.lastFocusableElement =\n\t\t\t\t\tfocusableElements[ focusableElements.length - 1 ];\n\t\t\t}\n\t\t},\n\t\tfocusFirstElement() {\n\t\t\tconst { ref } = getElement();\n\t\t\tif ( state.isMenuOpen ) {\n\t\t\t\tconst focusableElements =\n\t\t\t\t\tref.querySelectorAll( focusableSelectors );\n\t\t\t\tfocusableElements?.[ 0 ]?.focus();\n\t\t\t}\n\t\t},\n\t\tinitNav() {\n\t\t\tconst context = getContext();\n\t\t\tconst mediaQuery = window.matchMedia(\n\t\t\t\t`(max-width: ${ NAVIGATION_MOBILE_COLLAPSE })`\n\t\t\t);\n\n\t\t\t// Run once to set the initial state.\n\t\t\tcontext.isCollapsed = mediaQuery.matches;\n\n\t\t\tfunction handleCollapse( event ) {\n\t\t\t\tcontext.isCollapsed = event.matches;\n\t\t\t}\n\n\t\t\t// Run on resize to update the state.\n\t\t\tmediaQuery.addEventListener( 'change', handleCollapse );\n\n\t\t\t// Remove the listener when the component is unmounted.\n\t\t\treturn () => {\n\t\t\t\tmediaQuery.removeEventListener( 'change', handleCollapse );\n\t\t\t};\n\t\t},\n\t},\n} );\n"],"mappings":"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"}