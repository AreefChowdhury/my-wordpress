{"version":3,"names":["store","getContext","getElement","isValidLink","ref","window","HTMLAnchorElement","href","target","origin","location","isValidEvent","event","button","metaKey","ctrlKey","altKey","shiftKey","defaultPrevented","state","startAnimation","animation","finishAnimation","actions","navigate","ctx","queryRef","isDisabled","dataset","wpNavigationDisabled","preventDefault","timeout","setTimeout","message","loadingText","clearTimeout","loadedText","url","firstAnchor","querySelector","focus","prefetch","callbacks","setQueryRef"],"sources":["@wordpress/block-library/src/query/view.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { store, getContext, getElement } from '@wordpress/interactivity';\n\nconst isValidLink = ( ref ) =>\n\tref &&\n\tref instanceof window.HTMLAnchorElement &&\n\tref.href &&\n\t( ! ref.target || ref.target === '_self' ) &&\n\tref.origin === window.location.origin;\n\nconst isValidEvent = ( event ) =>\n\tevent.button === 0 && // Left clicks only.\n\t! event.metaKey && // Open in new tab (Mac).\n\t! event.ctrlKey && // Open in new tab (Windows).\n\t! event.altKey && // Download.\n\t! event.shiftKey &&\n\t! event.defaultPrevented;\n\nstore( 'core/query', {\n\tstate: {\n\t\tget startAnimation() {\n\t\t\treturn getContext().animation === 'start';\n\t\t},\n\t\tget finishAnimation() {\n\t\t\treturn getContext().animation === 'finish';\n\t\t},\n\t},\n\tactions: {\n\t\t*navigate( event ) {\n\t\t\tconst ctx = getContext();\n\t\t\tconst { ref } = getElement();\n\t\t\tconst { queryRef } = ctx;\n\t\t\tconst isDisabled = queryRef?.dataset.wpNavigationDisabled;\n\n\t\t\tif ( isValidLink( ref ) && isValidEvent( event ) && ! isDisabled ) {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// Don't announce the navigation immediately, wait 400 ms.\n\t\t\t\tconst timeout = setTimeout( () => {\n\t\t\t\t\tctx.message = ctx.loadingText;\n\t\t\t\t\tctx.animation = 'start';\n\t\t\t\t}, 400 );\n\n\t\t\t\tconst { actions } = yield import(\n\t\t\t\t\t'@wordpress/interactivity-router'\n\t\t\t\t);\n\t\t\t\tyield actions.navigate( ref.href );\n\n\t\t\t\t// Dismiss loading message if it hasn't been added yet.\n\t\t\t\tclearTimeout( timeout );\n\n\t\t\t\t// Announce that the page has been loaded. If the message is the\n\t\t\t\t// same, we use a no-break space similar to the @wordpress/a11y\n\t\t\t\t// package: https://github.com/WordPress/gutenberg/blob/c395242b8e6ee20f8b06c199e4fc2920d7018af1/packages/a11y/src/filter-message.js#L20-L26\n\t\t\t\tctx.message =\n\t\t\t\t\tctx.loadedText +\n\t\t\t\t\t( ctx.message === ctx.loadedText ? '\\u00A0' : '' );\n\n\t\t\t\tctx.animation = 'finish';\n\t\t\t\tctx.url = ref.href;\n\n\t\t\t\t// Focus the first anchor of the Query block.\n\t\t\t\tconst firstAnchor = `.wp-block-post-template a[href]`;\n\t\t\t\tqueryRef.querySelector( firstAnchor )?.focus();\n\t\t\t}\n\t\t},\n\t\t*prefetch() {\n\t\t\tconst { queryRef } = getContext();\n\t\t\tconst { ref } = getElement();\n\t\t\tconst isDisabled = queryRef?.dataset.wpNavigationDisabled;\n\t\t\tif ( isValidLink( ref ) && ! isDisabled ) {\n\t\t\t\tconst { actions } = yield import(\n\t\t\t\t\t'@wordpress/interactivity-router'\n\t\t\t\t);\n\t\t\t\tyield actions.prefetch( ref.href );\n\t\t\t}\n\t\t},\n\t},\n\tcallbacks: {\n\t\t*prefetch() {\n\t\t\tconst { url } = getContext();\n\t\t\tconst { ref } = getElement();\n\t\t\tif ( url && isValidLink( ref ) ) {\n\t\t\t\tconst { actions } = yield import(\n\t\t\t\t\t'@wordpress/interactivity-router'\n\t\t\t\t);\n\t\t\t\tyield actions.prefetch( ref.href );\n\t\t\t}\n\t\t},\n\t\tsetQueryRef() {\n\t\t\tconst ctx = getContext();\n\t\t\tconst { ref } = getElement();\n\t\t\tctx.queryRef = ref;\n\t\t},\n\t},\n} );\n"],"mappings":"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"}