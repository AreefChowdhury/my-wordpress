{"version":3,"names":["classnames","__","useEffect","Platform","useDispatch","useSelect","createBlock","getDefaultBlockName","AlignmentControl","BlockControls","RichText","useBlockProps","store","blockEditorStore","HeadingLevelDropdown","useBlockEditingMode","generateAnchor","setAnchor","HeadingEdit","attributes","setAttributes","mergeBlocks","onReplace","style","clientId","textAlign","content","level","placeholder","anchor","tagName","blockProps","className","blockEditingMode","canGenerateAnchors","select","getGlobalBlockCount","getSettings","settings","generateAnchors","__unstableMarkNextChangeAsNotPersistent","onContentChange","value","newAttrs","createElement","Fragment","group","onChange","newLevel","nextAlign","identifier","onMerge","onSplit","isOriginal","block","_getDefaultBlockName","onRemove","isNative","deleteEnter"],"sources":["@wordpress/block-library/src/heading/edit.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useEffect, Platform } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { createBlock, getDefaultBlockName } from '@wordpress/blocks';\nimport {\n\tAlignmentControl,\n\tBlockControls,\n\tRichText,\n\tuseBlockProps,\n\tstore as blockEditorStore,\n\tHeadingLevelDropdown,\n\tuseBlockEditingMode,\n} from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { generateAnchor, setAnchor } from './autogenerate-anchors';\n\nfunction HeadingEdit( {\n\tattributes,\n\tsetAttributes,\n\tmergeBlocks,\n\tonReplace,\n\tstyle,\n\tclientId,\n} ) {\n\tconst { textAlign, content, level, placeholder, anchor } = attributes;\n\tconst tagName = 'h' + level;\n\tconst blockProps = useBlockProps( {\n\t\tclassName: classnames( {\n\t\t\t[ `has-text-align-${ textAlign }` ]: textAlign,\n\t\t} ),\n\t\tstyle,\n\t} );\n\tconst blockEditingMode = useBlockEditingMode();\n\n\tconst { canGenerateAnchors } = useSelect( ( select ) => {\n\t\tconst { getGlobalBlockCount, getSettings } = select( blockEditorStore );\n\t\tconst settings = getSettings();\n\n\t\treturn {\n\t\t\tcanGenerateAnchors:\n\t\t\t\t!! settings.generateAnchors ||\n\t\t\t\tgetGlobalBlockCount( 'core/table-of-contents' ) > 0,\n\t\t};\n\t}, [] );\n\n\tconst { __unstableMarkNextChangeAsNotPersistent } =\n\t\tuseDispatch( blockEditorStore );\n\n\t// Initially set anchor for headings that have content but no anchor set.\n\t// This is used when transforming a block to heading, or for legacy anchors.\n\tuseEffect( () => {\n\t\tif ( ! canGenerateAnchors ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! anchor && content ) {\n\t\t\t// This side-effect should not create an undo level.\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\tsetAttributes( {\n\t\t\t\tanchor: generateAnchor( clientId, content ),\n\t\t\t} );\n\t\t}\n\t\tsetAnchor( clientId, anchor );\n\n\t\t// Remove anchor map when block unmounts.\n\t\treturn () => setAnchor( clientId, null );\n\t}, [ anchor, content, clientId, canGenerateAnchors ] );\n\n\tconst onContentChange = ( value ) => {\n\t\tconst newAttrs = { content: value };\n\t\tif (\n\t\t\tcanGenerateAnchors &&\n\t\t\t( ! anchor ||\n\t\t\t\t! value ||\n\t\t\t\tgenerateAnchor( clientId, content ) === anchor )\n\t\t) {\n\t\t\tnewAttrs.anchor = generateAnchor( clientId, value );\n\t\t}\n\t\tsetAttributes( newAttrs );\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t{ blockEditingMode === 'default' && (\n\t\t\t\t<BlockControls group=\"block\">\n\t\t\t\t\t<HeadingLevelDropdown\n\t\t\t\t\t\tvalue={ level }\n\t\t\t\t\t\tonChange={ ( newLevel ) =>\n\t\t\t\t\t\t\tsetAttributes( { level: newLevel } )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t\t<AlignmentControl\n\t\t\t\t\t\tvalue={ textAlign }\n\t\t\t\t\t\tonChange={ ( nextAlign ) => {\n\t\t\t\t\t\t\tsetAttributes( { textAlign: nextAlign } );\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t<RichText\n\t\t\t\tidentifier=\"content\"\n\t\t\t\ttagName={ tagName }\n\t\t\t\tvalue={ content }\n\t\t\t\tonChange={ onContentChange }\n\t\t\t\tonMerge={ mergeBlocks }\n\t\t\t\tonSplit={ ( value, isOriginal ) => {\n\t\t\t\t\tlet block;\n\n\t\t\t\t\tif ( isOriginal || value ) {\n\t\t\t\t\t\tblock = createBlock( 'core/heading', {\n\t\t\t\t\t\t\t...attributes,\n\t\t\t\t\t\t\tcontent: value,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tblock = createBlock(\n\t\t\t\t\t\t\tgetDefaultBlockName() ?? 'core/heading'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( isOriginal ) {\n\t\t\t\t\t\tblock.clientId = clientId;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn block;\n\t\t\t\t} }\n\t\t\t\tonReplace={ onReplace }\n\t\t\t\tonRemove={ () => onReplace( [] ) }\n\t\t\t\tplaceholder={ placeholder || __( 'Heading' ) }\n\t\t\t\ttextAlign={ textAlign }\n\t\t\t\t{ ...( Platform.isNative && { deleteEnter: true } ) } // setup RichText on native mobile to delete the \"Enter\" key as it's handled by the JS/RN side\n\t\t\t\t{ ...blockProps }\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nexport default HeadingEdit;\n"],"mappings":"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"}